<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Booking {{ booking.id }}</title>
  <style>
    @page { size: A4; margin: 18mm 14mm; }
    body {
      font-family: Verdana, sans-serif;
      font-size: 11.5px;
      color: #333;
      line-height: 1.5;
      margin: 0;
      padding: 0;
    }

    /* --- HEADER BANNER --- */
    .header-banner {
      width: 100%;
      height: 120px;
      background: #004d80 url("{{ STATIC_URL }}images/pdf_header_bg.jpg") no-repeat center center;
      background-size: cover;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      margin-bottom: 16px;
    }
    .header-banner h1 { margin: 0; font-size: 20px; font-weight: 700; }
    .header-banner p { margin: 4px 0 0; font-size: 12px; }

    /* Section Headings */
    h2 {
      font-size: 14px;
      margin: 12px 0 6px;
      color: #004d80;
      border-bottom: 1px solid #cce6ff;
      padding-bottom: 2px;
    }

    /* Layout */
    .row { display: flex; gap: 14px; }
    .col-8 { flex: 2; }
    .col-4 { flex: 1; }
    .section { margin-bottom: 12px; break-inside: avoid; }

    /* Tables */
    table { width: 100%; border-collapse: collapse; font-size: 11.5px; }
    th, td { padding: 6px 8px; border: 1px solid #ddd; }
    thead th {
      background: #e6f7ff;
      color: #004d80;
      font-weight: 600;
    }
    tbody tr:nth-child(even) { background: #fafafa; }
    tbody tr.fw-bold td { background: #004d80; color: #fff; }

    /* Cards */
    .card {
      border: 1px solid #cce6ff;
      border-radius: 6px;
      padding: 6px;
      margin-bottom: 8px;
      background: #f9fbff;
    }
    .card-title {
      font-size: 12px;
      text-align: center;
      font-weight: 600;
      margin: 4px 0;
      color: #004d80;
    }

    /* Images */
    .thumb-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 4px;
    }
    .thumb {
      width: 100%;
      height: 80px;
      object-fit: cover;
      border-radius: 4px;
    }
    .banner {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 4px;
    }

    /* Page control */
    .page-break { page-break-before: always; }

    /* Footer */
    .footer { position: running(footer); font-size: 10px; color: #555; text-align: center; }
    @page { @bottom-center { content: element(footer); } }
  </style>
</head>
<body>

  <div class="footer">Generated by TMS • Booking #{{ booking.id }}</div>

  <!-- PAGE 1 -->
  <div class="header-banner">
    <h1>Nomad Tour Management System</h1>
    <p>Booking #{{ booking.id }}</p>
  </div>

  <div class="row">
    <div class="col-8">
      <h2>Client Information</h2>
      <p><strong>Client:</strong> {{ booking.client.name }}</p>
      <p><strong>Start Date:</strong> {{ booking.start_date }}</p>
      <p><strong>End Date:</strong> {{ booking.end_date }}</p>

      <!-- Cost Breakdown -->
      <div class="section">
        <h2>Cost Breakdown</h2>
        <table>
          <thead>
            <tr><th>Category</th><th class="text-right">Cost</th></tr>
          </thead>
          <tbody>
            <tr><td>Accommodation</td><td class="text-right">${{ breakdown.Accommodation }}</td></tr>
            <tr><td>Activities</td><td class="text-right">${{ breakdown.Activities }}</td></tr>
            <tr><td>Dining</td><td class="text-right">${{ breakdown.Dining }}</td></tr>
            <tr><td>Transport</td><td class="text-right">${{ breakdown.Transport }}</td></tr>
            <tr class="fw-bold"><td>Total</td><td class="text-right">${{ breakdown.Total }}</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Destinations Sidebar -->
    <div class="col-4">
      <div class="section">
        <h2>Destinations</h2>
        {% for d in destinations %}
          <div class="card">
            <div class="card-title">{{ d.name }}</div>
            {% if d.galleries.all %}
              <div class="thumb-grid">
                {% for g in d.galleries.all|slice:":4" %}
                  {% if g.image %}
                    <img src="{{ g.image.url }}" class="thumb" alt="{{ d.name }}">
                  {% endif %}
                {% endfor %}
              </div>
            {% else %}
              <p class="muted">No images uploaded.</p>
            {% endif %}
          </div>
        {% empty %}
          <p class="muted">No destinations added yet.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- FORCE PAGE 2 -->
  <div class="page-break"></div>

  <!-- PAGE 2 -->
  <div class="header-banner">
    <h1>Nomad Tour Management System</h1>
    <p>Booking #{{ booking.id }} – Continued</p>
  </div>

  <!-- Travel Itinerary -->
  <div class="section">
    <h2>Travel Itinerary</h2>
    {% if travel_legs %}
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Mode</th>
            <th>From</th>
            <th>To</th>
            <th class="text-right">Cost</th>
          </tr>
        </thead>
        <tbody>
          {% for leg in travel_legs %}
          <tr>
            <td>{{ leg.date }}</td>
            <td>{{ leg.mode }}</td>
            <td>{{ leg.from_location }}</td>
            <td>{{ leg.to_location }}</td>
            <td class="text-right">${{ leg.cost }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No travel legs added yet.</p>
    {% endif %}
  </div>

  <!-- Restaurants -->
  <div class="section">
    <h2>Restaurants</h2>
    {% with all_dests=destinations %}
      {% for d in all_dests %}
        {% for r in d.restaurants.all %}
          <div class="card">
            {% if r.image %}
              <img src="{{ r.image.url }}" class="banner" alt="{{ r.name }}">
            {% endif %}
            <div class="card-title">{{ r.name }}</div>
            <div class="muted" style="text-align:center;">{{ d.name }}</div>
          </div>
        {% endfor %}
      {% endfor %}
      {% if not has_restaurants %}
        <p class="muted">No restaurants added yet.</p>
      {% endif %}
    {% endwith %}
  </div>

</body>
</html>
