{% extends "base_dashboard.html" %}
{% block content %}

<style>
.card {
  border-radius: 20px !important;
  transition: all 0.2s ease-in-out;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.08) !important;
}

/* Disable card hover when modal is open */
body.modal-open .card:hover {
  transform: none !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08) !important;
  z-index: auto !important;
}

.table-hover tbody tr:hover {
  background-color: #f9fbff;
}
.table th {
  font-size: 0.9rem;
  font-weight: 600;
  color: #555;
}
.table td {
  font-size: 0.95rem;
}
</style>

<div class="container-fluid py-4 bg-light min-vh-100">
  <div class="card shadow-lg border-0">
    <div class="card-body">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
        <h4 class="fw-bold mb-2">Clients</h4>
        <a href="{% url 'client_create' %}" class="btn btn-primary">
          <i class="bi bi-plus-circle me-1"></i> Add Client
        </a>
      </div>

      <!-- Search -->
      <div class="input-group mb-3" style="max-width: 350px;">
        <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
        <input type="text" id="clientSearch" class="form-control" placeholder="Search clients...">
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th style="width:150px;">Actions</th>
            </tr>
          </thead>
          <tbody id="clientTable">
            {% for client in clients %}
              <tr>
                <td class="fw-semibold">{{ client.first_name }} {{ client.last_name }}</td>
                <td>{{ client.email }}</td>
                <td>{{ client.phone_number }}</td>
                <td>
                  <div class="d-flex gap-2">
                    <a href="{% url 'client_update' client.pk %}" class="btn btn-sm btn-warning">
                      <i class="bi bi-pencil-square"></i> Edit
                    </a>
                    <!-- Trigger Delete Modal -->
                    <button 
                      class="btn btn-sm btn-danger" 
                      data-bs-toggle="modal" 
                      data-bs-target="#deleteClientModal{{ client.pk }}">
                      <i class="bi bi-trash"></i> Delete
                    </button>
                  </div>
                </td>
              </tr>

              <!-- Compact Delete Client Modal -->
              <div class="modal fade" id="deleteClientModal{{ client.pk }}" tabindex="-1" aria-labelledby="deleteClientModalLabel{{ client.pk }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content border-0 shadow-lg rounded-3">
                    
                    <!-- Modal Header -->
                    <div class="modal-header border-0 bg-light py-2">
                      <h6 class="modal-title fw-bold text-danger d-flex align-items-center" id="deleteClientModalLabel{{ client.pk }}">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i> Delete Client
                      </h6>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body text-center py-3">
                      <p class="mb-2">
                        Delete <span class="fw-semibold">{{ client.first_name }} {{ client.last_name }}</span>?
                      </p>
                      <p class="text-muted small mb-0">This action cannot be undone.</p>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer border-0 justify-content-center py-2">
                      <button type="button" class="btn btn-outline-secondary btn-sm px-3" data-bs-dismiss="modal">
                        Cancel
                      </button>
                      <form method="post" action="{% url 'client_delete' client.pk %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm px-3">
                          <i class="bi bi-trash me-1"></i> Delete
                        </button>
                      </form>
                    </div>
                    
                  </div>
                </div>
              </div>
              <!-- End Delete Modal -->

            {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted py-4">
                  <i class="bi bi-people fs-3 d-block mb-2"></i>
                  No clients found.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
// Simple client search filter
document.getElementById('clientSearch').addEventListener('keyup', function() {
  let filter = this.value.toLowerCase();
  let rows = document.querySelectorAll('#clientTable tr');
  rows.forEach(row => {
    let text = row.textContent.toLowerCase();
    row.style.display = text.includes(filter) ? '' : 'none';
  });
});
</script>

{% endblock %}
